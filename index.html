<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>صفحة استعلام المتدرب</title>
  <link rel="stylesheet" href="assets/style.css">
  <style>
    .searchWrap{max-width:700px;margin:0 auto;}
    .inp{
      width:100%;
      padding:16px 14px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color:#fff;font-size:20px;outline:none;
    }
    .btn{
      margin-top:14px;width:100%;
      border:none;cursor:pointer;
      padding:16px 12px;border-radius:18px;
      background: linear-gradient(180deg,#2fb4ff,#1186d6);
      color:#07223a;font-weight:900;font-size:20px;
      box-shadow:0 12px 22px rgba(0,0,0,.22);
    }
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .miniRow{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
    .miniBtn{
      border:none;cursor:pointer;
      padding:10px 12px;border-radius:14px;
      background: rgba(255,255,255,.10);
      color:#fff;font-weight:800;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="topBar">
      <h1 class="title" style="margin:0;font-size:30px;">صفحة استعلام المتدرب</h1>
    </div>

    <div class="card searchWrap">
      <div class="k" style="margin-bottom:10px;color:rgba(255,255,255,.8)">الرقم التدريبي</div>
      <input class="inp" id="inpId" inputmode="numeric" placeholder="اكتب الرقم التدريبي" />
      <button class="btn" id="btnSearch">بحث</button>

      <div class="error" id="errBox" style="display:none;"></div>

      <div class="miniRow">
        <button class="miniBtn" id="btnGoDash" style="display:none;">العودة للوحة الخدمات</button>
        <button class="miniBtn" id="btnLogout" style="display:none;">تسجيل خروج</button>
      </div>

      <div class="hint">بعد نجاح البحث سيتم نقلك إلى لوحة الخدمات</div>
    </div>
  </div>

  <script src="assets/app.js?v=1001"></script>
  <script>
    const btn = qs("btnSearch");
    const inp = qs("inpId");
    const btnGoDash = qs("btnGoDash");
    const btnLogout = qs("btnLogout");

    // أزرار مساعدة لو فيه جلسة
    const s = getSession();
    if (s?.id){
      btnGoDash.style.display = "inline-block";
      btnLogout.style.display = "inline-block";
      btnGoDash.onclick = ()=> location.replace("dashboard.html");
      btnLogout.onclick = ()=> { clearSession(); location.replace("index.html"); };
    }

    function onlyDigits(x){ return String(x||"").replace(/\D/g,""); }

    async function doSearch(){
      showError("errBox", "");
      btn.disabled = true;

      try{
        const id = onlyDigits(inp.value).trim();
        if (!id){
          showError("errBox","فضلاً أدخل الرقم التدريبي");
          btn.disabled = false;
          return;
        }

        const t = await searchTraineeById(id);
        if (!t){
          showError("errBox","لم يتم العثور على متدرب بهذا الرقم");
          btn.disabled = false;
          return;
        }

        saveSession(t);
        location.replace("dashboard.html");

      }catch(e){
        console.error(e);
        showError("errBox","تعذر الاتصال بالخادم. تحقق من رابط الـ API أو صلاحية النشر.");
        btn.disabled = false;
      }
    }

    btn.addEventListener("click", doSearch);
    inp.addEventListener("keydown",(e)=>{ if(e.key==="Enter") doSearch(); });
  </script>
</body>
</html>
